<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Admin Dashboard</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="adminDashboard.css">
</head>
<body>
  <form action="/logout" method="GET">
    <!-- Header -->
    <header class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">School Admin Dashboard</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" id="logoutLink" href="/logout">Logout</a>
          </li>
        </ul>
      </div>
    </header>
  
    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="#"><img id="ITS-Logo" src="/assets/img/ITSLogo.png" alt="CVSU-ITS Logo"></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/Dashboards/adminDashboard/adminProfile/adminProfile.html">ADMIN PROFILE</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="adminDashboard.html">RECORDS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../adminDashboard/Student_Registration/studentRegistrationForm.html">STUDENT REGISTRATION</a>
        </li>
      </ul>
    </div>
  
    <!-- Content Area -->
<div class="content">
  <h1>ADMIN DASHBOARD</h1>
  <!-- Add your content here -->

  <div id="Records" class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Student ID no.</th>
          <th>Student First Name</th>
          <th>Student Last Name</th>
          <th>Student Year and Section</th>
          <th>Student Email Address</th>
          <th>Student Password</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <!-- Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit User</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Add edit form here -->
					<form id="editForm">
						<input type="hidden" id="studentID" name="studentID">
						<label for="studentFirstName">Student First Name:</label>
						<input type="text" id="studentFirstName" name="studentFirstName"><br><br>
						<label for="studentLastName">Student Last Name:</label>
						<input type="text" id="studentLastName" name="studentLastName"><br><br>
						<label for="YearLevelAndSection">Year Level & Section:</label>
						<input type="text" id="YearLevelAndSection" name="YearLevelAndSection"><br><br>
						<label for="studentEmail">Email Address:</label>
						<input type="email" id="studentEmail" name="studentEmail"><br><br>
						<label for="studentPassword">Password:</label>
						<input type="text" id="studentPassword" name="studentPassword"><br><br>
					</form>
					
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveChanges()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Delete User</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this user?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Bootstrap JS -->
<script src="jquery-3.5.1.slim.min.js"></script>
<script src="popper.min.js"></script>
<script src="bootstrap.min.js"></script>
<script>
  // Toggle sidebar on small screens
  const sidebar = document.getElementById('sidebar');
  const navbarToggler = document.querySelector('.navbar-toggler');

  navbarToggler.addEventListener('click', function () {
    sidebar.classList.toggle('show');
  });

  function fetchRecords() {
    fetch('/recordsets')
      .then(response => response.json())
      .then(data => {
        // Iterate over the fetched data and create table rows dynamically
        data.forEach(record => {
          const tableRow = document.createElement("tr");
					// Inside the data.forEach loop
					tableRow.setAttribute("data-id", record.studentID);
          tableRow.innerHTML = `
            <td>${record.studentID}</td>
            <td>${record.studentFirstName}</td>
            <td>${record.studentLastName}</td>
            <td>${record.YearLevelAndSection}</td>
            <td>${record.studentEmail}</td>
            <td>${record.studentPassword}</td>
            <td class="table-actions">
              <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editModal"
                onclick="editUser('${record.studentID}', '${record.studentFirstName}', '${record.studentLastName}', '${record.YearLevelAndSection}', '${record.studentEmail}', '${record.studentPassword}')">Edit</button>
              <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal" onclick="deleteUser('${record.studentID}')">Delete</button>
            </td>
          `;
          document.querySelector("tbody").appendChild(tableRow);
        });
      })
      .catch(error => {
        console.error("Error fetching records:", error);
      });
  }

// Update the editUser function
function editUser(studentID, studentFirstName, studentLastName, YearLevelAndSection, studentEmail, studentPassword) {
	const editForm = document.getElementById("editForm");
	const idInput = editForm.getElementById("studentID");
	const firstNameInput = editForm.getElementById("studentFirstName");
	const lastNameInput = editForm.getElementById("studentLastName");
	const yearSectionInput = editForm.getElementById("YearLevelAndSection");
	const emailInput = editForm.getElementById("studentEmail");
	const passwordInput = editForm.getElementById("studentPassword");

  editForm.parentElement.setAttribute("data-id", studentID); // Update this line

	idInput.value = studentID;
	firstNameInput.value = studentFirstName;
	lastNameInput.value = studentLastName;
	yearSectionInput.value = YearLevelAndSection;
	emailInput.value = studentEmail;
	passwordInput.value = studentPassword;
}


// Update the saveChanges function
function saveChanges() {
	const form = document.getElementById("editForm");
	const studentID = form.parentElement.getAttribute("data-id"); // Update this line
	const studentFirstName = form.querySelector("#studentFirstName").value;
	const studentLastName = form.querySelector("#studentLastName").value;
	const YearLevelAndSection = form.querySelector("#YearLevelAndSection").value;
	const studentEmail = form.querySelector("#studentEmail").value;
	const studentPassword = form.querySelector("#studentPassword").value;

    const studentData = {
      studentID,
      studentFirstName,
      studentLastName,
      YearLevelAndSection,
      studentEmail,
      studentPassword
    };

    fetch(`/recordsets/update/${studentID}`, {
      method: 'PUT',
      body: JSON.stringify(studentData),
      headers: {
        'Content-Type': 'application/json'
      }
    })
      .then(response => response.json())
      .then(data => {
        console.log(data);
        $('#editModal').modal('hide');
        const editedTableRow = document.querySelector(`tr[data-id="${studentID}"]`);
        editedTableRow.innerHTML = `
          <td>${studentID}</td>
          <td>${studentFirstName}</td>
          <td>${studentLastName}</td>
          <td>${YearLevelAndSection}</td>
          <td>${studentEmail}</td>
          <td>${studentPassword}</td>
          <td class="table-actions">
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editModal"
              onclick="editUser('${studentID}', '${studentFirstName}', '${studentLastName}', '${YearLevelAndSection}', '${studentEmail}', '${studentPassword}')">Edit</button>
            <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal" onclick="deleteUser('${studentID}')">Delete</button>
          </td>
        `;
      })
      .catch(error => {
        console.error("Error updating user record:", error);
      });
  }


  // Call the fetchRecords function when the page is loaded
  window.addEventListener("load", fetchRecords);
</script>

</body>
</html>
